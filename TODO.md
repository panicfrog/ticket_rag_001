# RAG工单处理系统 - 开发待办事项清单

## 📋 项目概述
- **主要模型**: Qwen3 7B (本地部署)
- **微调模型**: Qwen3 1.7B (本地部署)
- **数据存储**: PostgreSQL + Qdrant + Redis (远程Docker Compose部署)
- **开发环境**: M1 Max Mac Studio (32GB统一内存)

---

## 🚀 阶段一：远程基础设施部署

### 1.1 远程服务器Docker Compose配置 (优先级：高)

#### 数据库服务栈
- [ ] **创建docker-compose.yml**
  - [ ] 配置PostgreSQL 15容器
  - [ ] 配置Qdrant向量数据库容器
  - [ ] 配置Redis缓存容器
  - [ ] 设置数据持久化卷
  - [ ] 配置网络和端口映射

- [ ] **PostgreSQL配置**
  - [ ] 设置用户名密码和数据库名
  - [ ] 配置连接池参数
  - [ ] 设置备份策略
  - [ ] 配置日志和监控

- [ ] **Qdrant向量数据库配置**
  - [ ] 设置集合(collection)配置
  - [ ] 配置向量维度(1024)
  - [ ] 设置索引类型和参数
  - [ ] 配置API端点和认证

- [ ] **Redis缓存配置**
  - [ ] 设置内存限制和淘汰策略
  - [ ] 配置持久化方式(AOF/RDB)
  - [ ] 设置过期时间策略
  - [ ] 配置主从复制(可选)

#### 服务部署和测试
- [ ] **部署服务栈**
  - [ ] 在远程服务器上部署Docker Compose
  - [ ] 验证所有服务启动正常
  - [ ] 测试服务间网络连通性
  - [ ] 配置防火墙和安全组

- [ ] **连接测试**
  - [ ] 测试PostgreSQL连接和基本操作
  - [ ] 测试Qdrant API可用性
  - [ ] 测试Redis连接和缓存功能
  - [ ] 网络延迟和性能测试

### 1.2 远程服务监控 (优先级：中)
- [ ] **健康检查配置**
  - [ ] PostgreSQL健康检查脚本
  - [ ] Qdrant API健康检查
  - [ ] Redis健康检查
  - [ ] 服务自动重启策略

- [ ] **监控和日志**
  - [ ] 容器日志收集配置
  - [ ] 性能监控指标
  - [ ] 磁盘空间监控
  - [ ] 网络流量监控

---

## 🤖 阶段二：本地模型部署

### 2.1 Ollama环境配置 (优先级：高)
- [ ] **Ollama安装与优化**
  - [ ] 在Mac Studio上安装Ollama
  - [ ] 配置M1 Max优化参数
  - [ ] 设置内存和并发限制
  - [ ] 配置服务自启动

- [ ] **环境变量配置**
  - [ ] 设置OLLAMA_HOST和端口
  - [ ] 配置OLLAMA_NUM_PARALLEL=6
  - [ ] 设置OLLAMA_MAX_LOADED_MODELS=3
  - [ ] 配置Apple Silicon优化参数

### 2.2 模型下载和部署 (优先级：高)
- [ ] **Embedding模型**
  - [ ] 拉取qwen3-embedding模型
  - [ ] 测试embedding生成性能
  - [ ] 验证向量维度(1024)
  - [ ] 批量处理性能测试

- [ ] **主要LLM模型 (7B)**
  - [ ] 拉取qwen3:7b模型
  - [ ] 测试文本生成质量
  - [ ] 调优temperature和max_tokens
  - [ ] 性能基准测试(吞吐量/延迟)

- [ ] **微调模型 (1.7B)**
  - [ ] 拉取qwen3:1.7b模型
  - [ ] 针对特定任务测试
    - [ ] 文本分类性能
    - [ ] 信息抽取准确性
    - [ ] 摘要生成质量
  - [ ] 配置任务路由策略

### 2.3 模型服务测试 (优先级：高)
- [ ] **API接口测试**
  - [ ] 测试所有模型API可用性
  - [ ] 并发请求压力测试
  - [ ] 错误处理和重试机制
  - [ ] 响应时间SLA验证

- [ ] **性能优化**
  - [ ] 模型预热策略
  - [ ] 内存使用优化
  - [ ] 并发处理调优
  - [ ] 模型切换策略

---

## 🏗️ 阶段三：核心服务开发

### 3.1 配置管理服务 (优先级：高)
- [ ] **配置加载器**
  - [ ] 实现TOML配置解析
  - [ ] 支持多环境配置
  - [ ] 配置热重载功能
  - [ ] 配置验证和默认值

- [ ] **服务发现**
  - [ ] 远程服务连接管理
  - [ ] 健康检查集成
  - [ ] 故障转移机制
  - [ ] 连接池管理

### 3.2 数据访问层 (优先级：高)
- [ ] **数据库连接**
  - [ ] PostgreSQL连接池配置
  - [ ] Qdrant客户端封装
  - [ ] Redis连接池管理
  - [ ] 事务管理和错误处理

- [ ] **数据模型定义**
  - [ ] 工单(Ticket)实体和表结构
  - [ ] 用户(User)实体和权限
  - [ ] 向量(Vector)存储结构
  - [ ] 数据库迁移脚本

- [ ] **Repository实现**
  - [ ] TicketRepository (PostgreSQL)
  - [ ] VectorRepository (Qdrant)
  - [ ] CacheRepository (Redis)
  - [ ] 统一数据访问接口

### 3.3 向量处理服务 (优先级：高)
- [ ] **Embedding服务**
  - [ ] Ollama客户端封装
  - [ ] 文本预处理pipeline
  - [ ] 批量embedding生成
  - [ ] 向量缓存策略

- [ ] **向量检索服务**
  - [ ] Qdrant检索接口
  - [ ] 多种相似度算法
  - [ ] 混合检索策略
  - [ ] 结果过滤和排序

- [ ] **本地Reranking实现**
  - [ ] Cross-encoder模型集成
  - [ ] 重排序算法优化
  - [ ] 候选结果筛选
  - [ ] 性能监控和调优

### 3.4 LLM服务抽象 (优先级：高)
- [ ] **模型路由器**
  - [ ] 根据任务类型选择模型
  - [ ] 7B模型用于复杂推理
  - [ ] 1.7B模型用于简单任务
  - [ ] 负载均衡策略

- [ ] **文本生成服务**
  - [ ] 统一的生成接口
  - [ ] 流式响应支持
  - [ ] 上下文管理
  - [ ] 输出质量控制

---

## 🧠 阶段四：业务逻辑开发

### 4.1 工单处理核心 (优先级：高)
- [ ] **工单创建流程**
  - [ ] 输入验证和清理
  - [ ] 自动分类(使用1.7B模型)
  - [ ] 关键信息抽取
  - [ ] 向量化和存储

- [ ] **智能检索系统**
  - [ ] 多模态检索策略
  - [ ] 语义搜索实现
  - [ ] 时间和类型过滤
  - [ ] 相关性排序

- [ ] **RAG Pipeline**
  - [ ] 检索增强生成流程
  - [ ] 上下文构建和优化
  - [ ] 模型选择策略
  - [ ] 答案生成和后处理

### 4.2 缓存策略 (优先级：中)
- [ ] **多级缓存设计**
  - [ ] 向量缓存(Redis)
  - [ ] 查询结果缓存
  - [ ] 模型输出缓存
  - [ ] 缓存一致性保证

- [ ] **缓存优化**
  - [ ] LRU淘汰策略
  - [ ] 预热和预加载
  - [ ] 分布式缓存同步
  - [ ] 缓存性能监控

### 4.3 日志和监控 (优先级：中)
- [ ] **日志系统**
  - [ ] 结构化日志配置
  - [ ] 分布式链路追踪
  - [ ] 错误日志告警
  - [ ] 日志聚合和分析

- [ ] **性能监控**
  - [ ] 模型调用监控
  - [ ] 数据库性能监控
  - [ ] 缓存命中率统计
  - [ ] 端到端延迟监控

---

## 🌐 阶段五：API接口开发

### 5.1 REST API设计 (优先级：高)
- [ ] **工单管理API**
  - [ ] `POST /api/tickets` - 创建工单
  - [ ] `GET /api/tickets` - 查询工单列表
  - [ ] `GET /api/tickets/{id}` - 获取工单详情
  - [ ] `PUT /api/tickets/{id}` - 更新工单状态

- [ ] **智能检索API**
  - [ ] `POST /api/search` - 语义搜索
  - [ ] `POST /api/ask` - 智能问答
  - [ ] `GET /api/similar/{id}` - 相似工单推荐
  - [ ] `POST /api/classify` - 工单分类

- [ ] **模型管理API**
  - [ ] `GET /api/models/status` - 模型状态检查
  - [ ] `POST /api/models/switch` - 模型切换
  - [ ] `GET /api/models/performance` - 性能统计

### 5.2 API基础设施 (优先级：高)
- [ ] **Axum框架配置**
  - [ ] 路由配置和中间件
  - [ ] CORS和安全配置
  - [ ] 请求限流和熔断
  - [ ] 统一错误处理

- [ ] **输入输出处理**
  - [ ] 请求验证和清理
  - [ ] 响应格式标准化
  - [ ] 流式响应支持
  - [ ] 文件上传处理

### 5.3 API文档和测试 (优先级：中)
- [ ] **API文档**
  - [ ] OpenAPI 3.0规范
  - [ ] 自动化文档生成
  - [ ] 交互式API测试
  - [ ] 使用示例和最佳实践

- [ ] **测试覆盖**
  - [ ] 单元测试(>90%覆盖率)
  - [ ] 集成测试
  - [ ] 端到端测试
  - [ ] 性能测试和压力测试

---

## 🔧 阶段六：部署和优化

### 6.1 生产环境准备 (优先级：低)
- [ ] **容器化配置**
  - [ ] 应用程序Dockerfile
  - [ ] 多阶段构建优化
  - [ ] 健康检查配置
  - [ ] 资源限制设置

- [ ] **CI/CD Pipeline**
  - [ ] 自动化测试流程
  - [ ] 代码质量检查
  - [ ] 自动化部署
  - [ ] 蓝绿部署策略

### 6.2 性能优化 (优先级：中)
- [ ] **系统优化**
  - [ ] 内存使用优化
  - [ ] 并发处理调优
  - [ ] 网络连接优化
  - [ ] 磁盘I/O优化

- [ ] **算法优化**
  - [ ] 向量检索算法优化
  - [ ] 缓存策略优化
  - [ ] 批处理优化
  - [ ] 预计算和预加载

---

## 📅 执行时间表

### 第一周：基础设施搭建
- [ ] 远程Docker Compose服务部署
- [ ] 本地Ollama模型部署
- [ ] 连接测试和基础配置

### 第二周：核心服务开发
- [ ] 配置管理和数据访问层
- [ ] 向量处理服务
- [ ] LLM服务抽象

### 第三周：业务逻辑实现
- [ ] 工单处理核心
- [ ] RAG pipeline
- [ ] 缓存策略实现

### 第四周：API开发和测试
- [ ] REST API实现
- [ ] 测试覆盖
- [ ] 文档编写

### 第五周：优化和部署
- [ ] 性能优化
- [ ] 生产环境准备
- [ ] 监控和告警

---

## 📊 成功指标

### 性能指标
- [ ] 向量检索延迟 < 100ms
- [ ] 问答响应时间 < 2s
- [ ] 系统可用性 > 99.5%
- [ ] 并发处理能力 > 100 QPS

### 质量指标
- [ ] 语义搜索准确率 > 85%
- [ ] 工单分类准确率 > 90%
- [ ] 问答相关性评分 > 4.0/5.0
- [ ] 用户满意度 > 4.5/5.0

---

## 🎯 下一步行动

**优先级1 - 立即执行：**
1. 配置远程服务器Docker Compose环境
2. 本地安装Ollama并部署三个模型
3. 测试所有服务连通性

需要我帮你开始执行第一个任务吗？ 